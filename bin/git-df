#!/usr/bin/env python
import json
import sys
from eswald.gittools import findroot, digests
from plumbum.cmd import git
from plumbum import FG

def df(params):
    # Store checksums of the changed files for use by git-ci.
    gitroot, cachefile = findroot()
    json.dump({
        "params": params,
        "digests": digests(gitroot, params),
    }, open(str(cachefile), "w"))
    
    # Run the diff command
    git["diff"][params] & FG

if __name__ == "__main__":
    df(sys.argv[1:])
